birthdata |> pivot_wider(names_from=agebin,values_from=birthrate) |> view()
birthdata <-
read_csv("C:/Users/jking34/Downloads/NCHS_-_Birth_Rates_for_Females_by_Age_Group__United_States.csv") |>
mutate(
agebin=gsub(" Years","",`Age Group`),
birthrate=`Birth Rate`,
year=Year
) |> filter(year < 1980) |> select(year,agebin,birthrate)
birthrate_add <- tibble(
year = rep(1980:1990,e=9),
agebin = rep(c("10-14","15-19","20-24","25-29",
"30-34","35-39","40-44","45-49",
"remainder"), 11),
birthrate = c(1.1,53.0,115.1,112.9,61.9,19.8,3.9,.2,0,
1.1,52.7,111.8,112.0,61.4,20.0,3.8,.2,0,
1.1,52.9,111.3,111.0,64.2,21.1,3.9,.2,0,
1.1,51.7,108.3,108.7,64.6,22.1,3.8,.2,0,
1.2,50.9,107.3,108.3,66.5,22.8,3.9,.2,0,
1.2,51.3,108.9,110.5,68.5,23.9,4.0,.2,0,
1.3,50.6,108.2,109.2,69.3,24.3,4.1,.2,0,
1.3,51.1,108.9,110.8,71.3,26.2,4.4,.2,0,
1.3,53.6,111.5,113.4,72.7,27.9,4.8,.2,0,
1.4,58.1,115.4,116.6,76.2,29.7,5.2,.2,0,
1.5,60.7,120.6,121.8,79.6,31.0,5.4,.2,0)
)
birthdata <- bind_rows(birthdata, birthrate_add)
ratedata <-
left_join(pop_str_data, birthdata) %>%
mutate(
birthrate=ifelse(agebin=="remainder",0,birthrate)
) |>
group_by(year) |>
mutate(
totalpop = sum(thous),
pop_str=thous/totalpop
) |> ungroup()
rates_crude <-
ratedata %>%
mutate(rate=birthrate*pop_str) %>%
group_by(year) %>%
summarise(rate=sum(rate),
factor="crude")
ggplot(rates_crude, aes(x=year,y=rate))+geom_path()
ggplot(ratedata, aes(x=year,y=pop_str,col=agebin))+geom_path()
dres.all <-
dgnpop(
ratedata,
pop="year",
factors=c("birthrate","pop_str"),
id_vars=c("agebin")
)
dres.all <-
dgnpop(
ratedata,
pop="year",
factors=c("birthrate","pop_str"),
id_vars=c("agebin")
)
dres.all <-
dgnpop(
ratedata,
pop="year",
factors=c("birthrate","pop_str"),
id_vars=c("agebin"),
quietly=FALSE
)
dgr = dg_rates(dres.all)
dgr
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
select(-factor) |> pivot_wider(names_from=type,values_from=rate)
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
#select(-factor) |> pivot_wider(names_from=type,values_from=rate)
ggplot(aes(x=year,y=rate,col=type,lty=type))+
geom_line()
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
select(-factor) |> pivot_wider(names_from=type,values_from=rate)
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
select(-factor) |> pivot_wider(names_from=type,values_from=rate) |> view()
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
select(-factor) |> pivot_wider(names_from=type,values_from=rate) |> mutate(.all=round(.all,1),crude=round(crude,1))
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
select(-factor) |> pivot_wider(names_from=type,values_from=rate) |> mutate(.all=round(.all,1),crude=round(crude,1)) |> view()
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
#select(-factor) |> pivot_wider(names_from=type,values_from=rate) |> view()
ggplot(aes(x=year,y=rate,col=type,lty=type))+
geom_line() + theme_bw()
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
#select(-factor) |> pivot_wider(names_from=type,values_from=rate) |> view()
ggplot(aes(x=year,y=rate,col=type,lty=type,size=1))+
geom_line() + theme_bw()
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
#select(-factor) |> pivot_wider(names_from=type,values_from=rate) |> view()
ggplot(aes(x=year,y=rate,col=type,lty=type,size=1=.5))+
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
#select(-factor) |> pivot_wider(names_from=type,values_from=rate) |> view()
ggplot(aes(x=year,y=rate,col=type,lty=type,size=.5))+
geom_line() + theme_bw()
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
#select(-factor) |> pivot_wider(names_from=type,values_from=rate) |> view()
ggplot(aes(x=year,y=rate,col=type,lty=type,lwd=.5))+
geom_line() + theme_bw()
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
#select(-factor) |> pivot_wider(names_from=type,values_from=rate) |> view()
ggplot(aes(x=year,y=rate,col=type,lty=type,lwd=.2))+
geom_line() + theme_bw()
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
#select(-factor) |> pivot_wider(names_from=type,values_from=rate) |> view()
ggplot(aes(x=year,y=rate,col=type,lty=type),lwd=.2)+
geom_line() + theme_bw()
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
#select(-factor) |> pivot_wider(names_from=type,values_from=rate) |> view()
ggplot(aes(x=year,y=rate,col=type,lty=type),lwd=.5)+
geom_line() + theme_bw()
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
#select(-factor) |> pivot_wider(names_from=type,values_from=rate) |> view()
ggplot(aes(x=year,y=rate,col=type,lty=type),lwd=1)+
geom_line() + theme_bw()
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
#select(-factor) |> pivot_wider(names_from=type,values_from=rate) |> view()
ggplot(aes(x=year,y=rate,col=type,lty=type),size=1)+
geom_line() + theme_bw()
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
#select(-factor) |> pivot_wider(names_from=type,values_from=rate) |> view()
ggplot(aes(x=year,y=rate,col=type,lty=type))+
geom_line(size=1) + theme_bw()
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
#select(-factor) |> pivot_wider(names_from=type,values_from=rate) |> view()
ggplot(aes(x=year,y=rate,col=type,lty=type))+
geom_line(size=1) + theme_bw()+xlim(13,33)
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
#select(-factor) |> pivot_wider(names_from=type,values_from=rate) |> view()
ggplot(aes(x=year,y=rate,col=type,lty=type))+
geom_line(size=1) + theme_bw()+ ylim(13,33)
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
#select(-factor) |> pivot_wider(names_from=type,values_from=rate) |> view()
ggplot(aes(x=year,y=rate,col=type,lty=type))+
geom_line(size=1) + theme_bw()+
scale_y_continuous(limits=c(13,33),breaks=c(13,18,23,28,33))
ratedata
left_join(pop_str_data, birthdata) %>%
mutate(
birthrate=ifelse(agebin=="remainder",0,birthrate)
)
left_join(pop_str_data, birthdata) %>%
mutate(
birthrate=ifelse(agebin=="remainder",0,birthrate)
)  |> head()
left_join(pop_str_data, birthdata) %>%
mutate(
birthrate=ifelse(agebin=="remainder",0,birthrate)
) |>
write_csv(file="archive/uspop_dg.csv")
library(tidyverse)
# eseed=round(runif(1,1e3,1e5))
set.seed(29330)
N = 600
age = round(runif(N,18,60))
# think of these as latent "propensities for anxiety, positive and negative affect"
# based on distributions i can find, gad and panas_neg should be skewed right.
# panas_pos fairly centered.
# it feels sensible to make gad and panas_neg positively correlated,
# and they are both negatively correlated with panas_pos
pGPN = MASS::mvrnorm(N, mu=c(-1.5,-.5,0),
Sigma = matrix(c(
1,.4,-.3,
.4,1,-.5,
-.3,-.5,1
), nrow=3))
# observed scores (sneaky way of using binomial to sim likert like data)
anxiety = sapply(pGPN[,1], \(x) sum(replicate(7, rbinom(1,3,plogis(x)))))
negative_affect= sapply(pGPN[,2], \(x) sum(replicate(10, rbinom(1,4,plogis(x))+1)))
positive_affect = sapply(pGPN[,3], \(x) sum(replicate(10, rbinom(1,4,plogis(x))+1)))
# distributions:
par(mfrow=c(3,1))
hist(anxiety);hist(positive_affect);hist(negative_affect)
pairs(cbind(anxiety,positive_affect,negative_affect))
# experimental grid
expgrid = tidyr::expand_grid(
tilt_condition = c("up","down","none"),
occlusion_condition = c("upper","lower"),
n = 1:100
)
# data
dat = data.frame(
anxiety,negative_affect,positive_affect,
expgrid[,-3]
)
dat$tilt_condition = factor(dat$tilt_condition, levels=c("none","down","up"))
# model matrix for outcome
Xmat = model.matrix(rnorm(N) ~ scale(anxiety) + scale(negative_affect) + scale(positive_affect) + tilt_condition * occlusion_condition,
data = dat)
# we need coefficients for population model, in this order:
dimnames(Xmat)[[2]]
# linear predictor:
lp = Xmat %*% c(0, .1, .1, 0,
.4, .4, 0,
-.2, .1)
# outcome, then scaled somehow
dat$dominance = rnorm(N, lp, 1)
# dominanceinance is based on https://www.sciencedirect.com/science/article/pii/S1090513810000267#app1
# which is apparently 8 x 7-point likerts, so range 8-56
dat$dominance = round(28.4 + scale(dat$dominance)[,1]*6.2)
range(dat$dominance)
# make sure data is randominancely shuffled
# (otherwise students will panick with DWT of autocorrelation)
dat = dat[sample(1:N), ]
row.names(dat) <- NULL
dat$PID = paste0("PPT_",1:N)
head(dat)
dat$age <- age
dat <- dat %>% relocate(PID, .before=anxiety)
dat <- dat %>% relocate(age, .before=anxiety)
# test:
lm(dominance ~ anxiety + negative_affect + positive_affect + tilt_condition * occlusion_condition,
data = dat) |>
summary()
###### basic solution ##########
library(tidyverse)
library(emmeans)
library(psych)
library(kableExtra)
library(interactions)
library(sjPlot)
str(dat)
###make conditions factors
dat <- dat %>%
mutate(
tilt_condition = factor(tilt_condition),
occlusion_condition = factor(occlusion_condition)
)
##check levels - set reference groups & justify
levels(dat$tilt_condition)
levels(dat$occlusion_condition)
##check for missing data
table(is.na(dat))
##descriptives
desc <- dat %>%
group_by(tilt_condition, occlusion_condition) %>%
summarise(n = n(),
M = mean(dominance),
SD = sd(dominance)) %>%
kable(., caption = "Descriptives", digits = 2) %>%
kable_styling()
desc
##basic plot
p1 <- ggplot(data = dat, aes(x = tilt_condition, y = dominance, color = occlusion_condition)) +
geom_boxplot() +
labs(x = 'Tilt Condition', y = 'Dominance Rating') +
theme_classic()
p1
##run model
m1 <-lm(dominance ~ anxiety + negative_affect + positive_affect + tilt_condition * occlusion_condition, data = dat)
summary(m1)
##check assumptions
par(mfrow=c(2,2))
plot(m1)
par(mfrow=c(1,1))
##table results
library(sjPlot)
tab_model(m1,
show.stat = TRUE,
dv.labels = "Dominance Ratings",
title = "Regression Results")
##plot model
library(interactions)
plt_m1 <- cat_plot(model = m1,
pred = occlusion_condition,
modx = tilt_condition)
plt_m1
emm <- emmeans(m1,~tilt_condition * occlusion_condition)
emm
pairs(emm)
## whether the difference in dominance ratings between face occlusion conditions differed between those that saw tilted and non-tilted heads
occlusion_coef  <- c('lower' = 1, 'upper' = -1)
tilt_coef  <- c('down' = .5, 'up' = .5, 'none' = -1)
contr = tilt_coef %o% occlusion_coef
contr
comp <- contrast(emm, method = list('Hyp' = c(0.5, -1, 0.5, -0.5, 1, -0.5)))
summary(comp, infer=T)
2+2+1
5/4
library(googlesheets4)
library(tidyverse)
wd <- read_sheet("1QyLPrJMCqUpR7BTjwtSkPURqmwQ-Obvf6M7MNDn0S1Q")
wd <- read_sheet("1QyLPrJMCqUpR7BTjwtSkPURqmwQ-Obvf6M7MNDn0S1Q")
head(wd)
wd$grapes
strsplit(wd$grapes,split=",")
wd$g2 = strsplit(wd$grapes,split=",")
wd$g2
strsplit(gsub("[0-9%]","",wd$grapes),split=",")
wd$g2 = strsplit(gsub("[0-9%]","",wd$grapes),split=",")
wd
wd |> unnest(g2)
wd |> unnest(g2) |>
mutate(g2 = gsub(" ","",tolower(g2)))
wd |> unnest(g2) |>
mutate(g2 = gsub(" ","",tolower(g2))) |>
ggplot(aes(x=g2))+
stat_summary(geom="pointrange",aes(y=caz))
wd |> unnest(g2) |>
mutate(g2 = gsub(" ","",tolower(g2))) |>
ggplot(aes(x=g2))+
stat_summary(geom="pointrange",aes(y=caz))+
coord_flip()
ggplot(wd, aes(x=grape))+
stat_summary(geom="pointrange",aes(y=caz))+
coord_flip()
ggplot(wd, aes(x=grape))
ggplot(wd, aes(x=grapes))+
stat_summary(geom="pointrange",aes(y=caz))+
coord_flip()
wd |> filter(!grepl(",",grapes)) |>
ggplot(aes(x=grapes))+
stat_summary(geom="pointrange",aes(y=caz))+
coord_flip()
wd |> filter(!grepl(",",grapes)) |>
mutate(grapes = tolower(grapes)) |>
ggplot(aes(x=grapes))+
stat_summary(geom="pointrange",aes(y=caz))+
coord_flip()
wd |> filter(!grepl(",",grapes)) |>
mutate(grapes = tolower(grapes)) |>
ggplot(aes(x=grapes))+
stat_summary(geom="pointrange",aes(y=jo))+
coord_flip()
wd |> filter(!grepl(",",grapes)) |>
mutate(grapes = tolower(grapes)) |>
ggplot(aes(x=country))+
stat_summary(geom="pointrange",aes(y=jo),col="blue")+
stat_summary(geom="pointrange",aes(y=caz),col="red")+
coord_flip()
wd |> filter(!grepl(",",grapes)) |>
mutate(grapes = tolower(grapes)) |>
ggplot(aes(x=country))+
stat_summary(geom="pointrange",aes(y=jo),col="blue")+
stat_summary(geom="pointrange",aes(y=caz),col="red")+
geom_jitter(aes(y=caz),col="red",width=.1,height=0)+
coord_flip()
wd |> filter(!grepl(",",grapes)) |>
mutate(grapes = tolower(grapes)) |>
ggplot(aes(x=country))+
stat_summary(geom="pointrange",aes(y=jo),col="blue")+
stat_summary(geom="pointrange",aes(y=caz),col="red")+
geom_jitter(aes(y=caz),col="red",width=.1,height=0,alpha=.3)+
coord_flip()
wd |> filter(!grepl(",",grapes)) |>
mutate(grapes = tolower(grapes)) |>
ggplot(aes(x=country))+
stat_summary(geom="pointrange",aes(y=jo),col="blue")+
stat_summary(geom="pointrange",aes(y=caz),col="red")+
geom_jitter(aes(y=caz),col="red",width=.1,height=0,alpha=.3)+
geom_jitter(aes(y=jo),col="blue",width=.1,height=0,alpha=.3)+
coord_flip()
wd |> filter(!grepl(",",grapes)) |>
mutate(grapes = tolower(grapes)) |>
ggplot(aes(x=country))+
stat_summary(geom="pointrange",aes(y=jo),col="blue")+
geom_jitter(aes(y=jo),col="blue",width=.1,height=0,alpha=.3)+
coord_flip()
ggplot(aes(x=country))+
stat_summary(geom="pointrange",aes(y=caz),col="red")+
geom_jitter(aes(y=caz),col="red",width=.1,height=0,alpha=.3)+
coord_flip()
ggplot(aes(x=country))+
stat_summary(geom="pointrange",aes(y=caz),col="red")+
geom_jitter(aes(y=caz),col="red",width=.1,height=0,alpha=.3)+
coord_flip()
wd |> filter(!grepl(",",grapes)) |>
mutate(grapes = tolower(grapes)) |>
ggplot(aes(x=country))+
stat_summary(geom="pointrange",aes(y=caz),col="red")+
geom_jitter(aes(y=caz),col="red",width=.1,height=0,alpha=.3)+
coord_flip()
wd |> filter(!grepl(",",grapes)) |>
mutate(grapes = tolower(grapes)) |>
ggplot(aes(x=grapes))+
stat_summary(geom="pointrange",aes(y=jo),col="blue")+
geom_jitter(aes(y=jo),col="blue",width=.1,height=0,alpha=.3)+
coord_flip()
wd |> filter(!grepl(",",grapes)) |>
mutate(grapes = tolower(grapes)) |>
ggplot(aes(x=grapes))+
stat_summary(geom="pointrange",aes(y=caz),col="red")+
geom_jitter(aes(y=caz),col="red",width=.1,height=0,alpha=.3)+
coord_flip()
wd |> #filter(!grepl(",",grapes)) |>
mutate(grapes = tolower(grapes)) |>
ggplot(aes(x=grapes))+
stat_summary(geom="pointrange",aes(y=caz),col="red")+
geom_jitter(aes(y=caz),col="red",width=.1,height=0,alpha=.3)+
coord_flip()
wd |> filter(!grepl(",",grapes)) |>
mutate(grapes = tolower(grapes)) |>
ggplot(aes(x=grapes))+
stat_summary(geom="pointrange",aes(y=caz),col="red")+
geom_jitter(aes(y=caz),col="red",width=.1,height=0,alpha=.3)+
coord_flip()
library(patchwork)
p1 <- wd |> filter(!grepl(",",grapes)) |>
mutate(grapes = tolower(grapes)) |>
ggplot(aes(x=grapes))+
stat_summary(geom="pointrange",aes(y=jo),col="blue")+
geom_jitter(aes(y=jo),col="blue",width=.1,height=0,alpha=.3)+
coord_flip()
p2 <- wd |> filter(!grepl(",",grapes)) |>
mutate(grapes = tolower(grapes)) |>
ggplot(aes(x=grapes))+
stat_summary(geom="pointrange",aes(y=caz),col="red")+
geom_jitter(aes(y=caz),col="red",width=.1,height=0,alpha=.3)+
coord_flip()
p1+p2
