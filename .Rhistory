ggplot(aes(x=year,y=rate,col=type,lty=type))+
geom_line()
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".1940"),
dgr79 |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".1979"),
dgrall |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |> print()
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".1940"),
dgr79 |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".1979"),
dgrall |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |> pivot_wider(names_from=type,values_from=rate)
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".1940"),
dgr79 |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".1979"),
dgrall |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
select(-factor) |> pivot_wider(names_from=type,values_from=rate)
dg_rates(dres.1940)
dgr |> filter(factor=="birthrate")
dres.1940
dg_rates(dres.1940)
dg_rates(dres.1940) |> filter(factor=="birthrate")
dgnpop(
ratedata[ratedata$year<1942,],
pop="year",
factors=c("birthrate","pop_str"),
id_vars=c("agebin")
)
dgnpop(
ratedata[ratedata$year<1942,],
pop="year",
factors=c("birthrate","pop_str"),
id_vars=c("agebin")
) |> dg_rates()
dres.1940
dgnpop(
ratedata[ratedata$year<1942,],
pop="year",
factors=c("birthrate","pop_str"),
id_vars=c("agebin")
) |> dg_rates()
dgnpop(
ratedata[ratedata$year<1942,],
pop="year",
factors=c("birthrate","pop_str"),
id_vars=c("agebin")
) |> dg_rates() |> filter(factor=="birthrate")
dg_rates(dres.1940) |> filter(factor=="birthrate")
dres.1940
View(dres.1940)
lapply(list.files("R/",full.names=T),\(x) source(x))
dgnpop(
ratedata,
pop="year",
factors=c("birthrate","pop_str"),
id_vars=c("agebin"),
baseline = 1940
)
dgres.1940
dres.1940
dres.1940 |> arrange(pop,agegroup,year)
dres.1940 |> arrange(pop,agegroup,factor)
dres.1940 |> arrange(pop,agebin,factor)
dres.1940 |> arrange(pop,agebin,factor) |> head()
dgnpop(
ratedata,
pop="year",
factors=c("birthrate","pop_str"),
id_vars=c("agebin"),
baseline = 1940
)
lapply(list.files("R/",full.names=T),\(x) source(x))
dgnpop(
ratedata,
pop="year",
factors=c("birthrate","pop_str"),
id_vars=c("agebin"),
baseline = 1940
)
data.frame()
lapply(list.files("R/",full.names=T),\(x) source(x))
dgnpop(
ratedata,
pop="year",
factors=c("birthrate","pop_str"),
id_vars=c("agebin"),
baseline = 1940
)
lapply(list.files("R/",full.names=T),\(x) source(x))
dres.1940 <-
dgnpop(
ratedata,
pop="year",
factors=c("birthrate","pop_str"),
id_vars=c("agebin"),
baseline = 1940
)
dres.1979 <-
dgnpop(
ratedata,
pop="year",
factors=c("birthrate","pop_str"),
id_vars=c("agebin"),
baseline = 1979
)
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".1940"),
dgr79 |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".1979"),
dgrall |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
# select(-factor) |> pivot_wider(names_from=type,values_from=rate)
ggplot(aes(x=year,y=rate,col=type,lty=type))+
geom_line()
dgr = dg_rates(dres.1940)
dgr79 = dg_rates(dres.1979)
dgrall = dg_rates(dres.all)
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".1940"),
dgr79 |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".1979"),
dgrall |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
# select(-factor) |> pivot_wider(names_from=type,values_from=rate)
ggplot(aes(x=year,y=rate,col=type,lty=type))+
geom_line()
dres.1979
dg_rates(dres.1979)
dg_rates(dres.1940)
head(dgr)
head(dgr79)
head(dres.1940)
head(dres.1979)
bind_rows(
#rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".1940"),
dgr79 |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".1979"),
# dgrall |> filter(factor=="birthrate") |>
#   transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
# select(-factor) |> pivot_wider(names_from=type,values_from=rate)
ggplot(aes(x=year,y=rate,col=type,lty=type))+
geom_line()
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".1940"),
dgr79 |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".1979"),
dgrall |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
select(-factor) |> pivot_wider(names_from=type,values_from=rate)
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="pop_str") |>
transmute(year = pop, rate=adj.rate,type=".1940"),
dgr79 |> filter(factor=="pop_str") |>
transmute(year = pop, rate=adj.rate,type=".1979"),
dgrall |> filter(factor=="pop_str") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
select(-factor) |> pivot_wider(names_from=type,values_from=rate)
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="pop_str") |>
transmute(year = pop, rate=adj.rate,type=".1940"),
dgr79 |> filter(factor=="pop_str") |>
transmute(year = pop, rate=adj.rate,type=".1979"),
dgrall |> filter(factor=="pop_str") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
#select(-factor) |> pivot_wider(names_from=type,values_from=rate)
ggplot(aes(x=year,y=rate,col=type,lty=type))+
geom_line()
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".1940"),
dgr79 |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".1979"),
dgrall |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
select(-factor) |> pivot_wider(names_from=type,values_from=rate)
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".1940"),
dgr79 |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".1979"),
dgrall |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
#select(-factor) |> pivot_wider(names_from=type,values_from=rate)
ggplot(aes(x=year,y=rate,col=type,lty=type))+
geom_line()
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".1940"),
dgr79 |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".1979"),
dgrall |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
select(-factor) |> pivot_wider(names_from=type,values_from=rate)
res = lapply(1941:1979, \(x) dgnpop(
ratedata |> filter(year %in% c(1940,x)),
pop="year",
factors=c("birthrate","pop_str"),
id_vars=c("agebin")
))
head(res)
do.call(rbind,res)
do.call(rbind,res) |> arrange(pop,factor)
do.call(rbind,res) |> arrange(pop,factor) |> head()
do.call(rbind,res) |> arrange(pop,factor) |>
filter(adj.set==1940)
do.call(rbind,res) |> arrange(pop,factor) |>
filter(adj.set==1940) |>
dg_rates()
dg_rates(dres.1940)
do.call(rbind,res) |> arrange(pop,factor) |>
filter(adj.set==1940) |>
dg_rates() |> head()
lapply(list.files("R/",full.names=T),\(x) source(x))
# The case of 2 factors (2 populations)
eg2.1 <- data.frame(
pop = c("black","white"),
avg_earnings = c(10930, 16591),
earner_prop = c(.717892, .825974)
)
dgnpop(
ratedata,
pop="year",
factors=c("birthrate","pop_str"),
id_vars=c("agebin"),
baseline = 1979
)
lapply(list.files("R/",full.names=T),\(x) source(x))
dgnpop(
ratedata,
pop="year",
factors=c("birthrate","pop_str"),
id_vars=c("agebin"),
baseline = 1979
)
lapply(list.files("R/",full.names=T),\(x) source(x))
dgnpop(
ratedata,
pop="year",
factors=c("birthrate","pop_str"),
id_vars=c("agebin"),
baseline = 1979
)
dres.1979 <-
dgnpop(
ratedata,
pop="year",
factors=c("birthrate","pop_str"),
id_vars=c("agebin"),
baseline = 1979
)
dgr792 = dg_rates(dres.1979)
head(dgr79)
head(dgr792)
dres.1940 <-
dgnpop(
ratedata,
pop="year",
factors=c("birthrate","pop_str"),
id_vars=c("agebin"),
baseline = 1940
)
dres.1979 <-
dgnpop(
ratedata,
pop="year",
factors=c("birthrate","pop_str"),
id_vars=c("agebin"),
baseline = 1979
)
dgr = dg_rates(dres.1940)
dgr79 = dg_rates(dres.1979)
dgrall = dg_rates(dres.all)
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".1940"),
dgr79 |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".1979"),
dgrall |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
select(-factor) |> pivot_wider(names_from=type,values_from=rate)
bind_rows(
rates_crude |> mutate(type="crude",year=as.character(year)),
dgr |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".1940"),
dgr79 |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".1979"),
dgrall |> filter(factor=="birthrate") |>
transmute(year = pop, rate=adj.rate,type=".all")
) |> mutate(year=as.numeric(year)) |>
arrange(year,type) |>
#select(-factor) |> pivot_wider(names_from=type,values_from=rate)
ggplot(aes(x=year,y=rate,col=type,lty=type))+
geom_line()
dgr
dgr |> filter(year %in% c(1941,1957))
dgr |> filter(pop %in% c(1941,1957))
pop_str_data
manual <- tibble(
year = rep(1980:1990,e=9),
agebin = rep(c("10-14","15-19","20-24","25-29",
"30-34","35-39","40-44","45-49",
"remainder"), 10)
)
manual <- tibble(
year = rep(1980:1990,e=9),
agebin = rep(c("10-14","15-19","20-24","25-29",
"30-34","35-39","40-44","45-49",
"remainder"), 11)
)
manual <- tibble(
year = rep(1980:1990,e=9),
agebin = rep(c("10-14","15-19","20-24","25-29",
"30-34","35-39","40-44","45-49",
"remainder"), 11),
thous = c(8923,10377,10680,9896,8974,7159,5988,5677,159581,
8953,10080,10790,10132,9481,7310,6136,5643,161112,
8877,9779,10781,10396,9482,7918,6354,5656,162753,
8747,9471,10729,10607,9672,8201,6699,5754,164404,
8544,9231,10642,10753,9900,8584,6942,5872,165997,
8339,9106,10482,10869,10172,8967,7167,5968,167666,
8078,9126,10183,10982,10407,9467,7316,6110,169436,
8035,9047,9877,10971,10674,9466,7929,6325,171103,
8102,8923,9576,10924,10895,9660,8210,6668,172847,
8260,8721,9335,10837,11059,9890,8589,6920,174648,
8447,8525,9223,10691,11175,10167,8987,7150,176648)
)
pop_str_add <- tibble(
year = rep(1980:1990,e=9),
agebin = rep(c("10-14","15-19","20-24","25-29",
"30-34","35-39","40-44","45-49",
"remainder"), 11),
thous = c(8923,10377,10680,9896,8974,7159,5988,5677,159581,
8953,10080,10790,10132,9481,7310,6136,5643,161112,
8877,9779,10781,10396,9482,7918,6354,5656,162753,
8747,9471,10729,10607,9672,8201,6699,5754,164404,
8544,9231,10642,10753,9900,8584,6942,5872,165997,
8339,9106,10482,10869,10172,8967,7167,5968,167666,
8078,9126,10183,10982,10407,9467,7316,6110,169436,
8035,9047,9877,10971,10674,9466,7929,6325,171103,
8102,8923,9576,10924,10895,9660,8210,6668,172847,
8260,8721,9335,10837,11059,9890,8589,6920,174648,
8447,8525,9223,10691,11175,10167,8987,7150,176648)
)
pop_str_data
pop_str_add
pop_str_data <- bind_rows(pop_str_data, pop_str_add)
birthrate_add <- tibble(
year = rep(1980:1990,e=9),
agebin = rep(c("10-14","15-19","20-24","25-29",
"30-34","35-39","40-44","45-49",
"remainder"), 11),
birthrate = c(1.1,53.0,115.1,112.9,61.9,19.8,3.9,.2,0,
1.1,52.7,111.8,112.0,61.4,20.0,3.8,.2,0,
1.1,52.9,111.3,111.0,64.2,21.1,3.9,.2,0,
1.1,51.7,108.3,108.7,64.6,22.1,3.8,.2,0,
1.2,50.9,107.3,108.3,66.5,22.8,3.9,.2,0,
1.2,51.3,108.9,110.5,68.5,23.9,4.0,.2,0,
1.3,50.6,108.2,109.2,69.3,24.3,4.1,.2,0,
1.3,51.1,108.9,110.8,71.3,26.2,4.4,.2,0,
1.3,53.6,111.5,113.4,72.7,27.9,4.8,.2,0,
1.4,58.1,115.4,116.6,76.2,29.7,5.2,.2,0,
1.5,60.7,120.6,121.8,79.6,31.0,5.4,.2,0)
)
birthdata <- bind_rows(birthdata, birthrate_add)
ratedata <-
left_join(pop_str_data, birthdata) %>%
mutate(
birthrate=ifelse(agebin=="remainder",0,birthrate)
)
left_join(ratedata,
ratedata %>% group_by(year) %>%
summarise(
totalpop=sum(thous)
)
) %>%
mutate(
pop_str=thous/totalpop
) -> ratedata
rates_crude <-
ratedata %>%
mutate(rate=birthrate*pop_str) %>%
group_by(year) %>%
summarise(rate=sum(rate),
factor="crude")
ggplot(rates_crude, aes(x=year,y=rate))+geom_path()
rates_crude
ratedata
ggplot(ratedata, aes(x=year,y=birthdate,col=agebin))+geom_path()
ggplot(ratedata, aes(x=year,y=birthrate,col=agebin))+geom_path()
ggplot(ratedata, aes(x=year,y=pop_str,col=agebin))+geom_path()
birthdata
pop_str_data
View(pop_str_data)
ggplot(pop_str_data, aes(x=year,y=thous,col=agebin))+geom_path()
library(devtools)
library(roxygen)
library(roxyge1)
library(roxygen2)
document()
# The case of 2 factors (2 populations)
eg2.1 <- data.frame(
pop = c("black","white"),
avg_earnings = c(10930, 16591),
earner_prop = c(.717892, .825974)
)
dgnpop(eg2.1, pop="pop",factors=c("avg_earnings", "earner_prop"))
dgnpop(eg2.1, pop="pop",factors=c("avg_earnings", "earner_prop")) |>
print() |>
dg_rates()
dgnpop(eg2.3, pop="pop", factors=c("birthsw1549", "propw1549", "propw")) |>
print() |>
dg_rates()
# The case of 3 factors (2 populations)
eg2.3 <- data.frame(
pop = c("austria","chile"),
birthsw1549 = c(51.78746, 84.90502),
propw1549 = c(.45919, .75756),
propw = c(.52638, .51065)
)
dgnpop(eg2.3, pop="pop", factors=c("birthsw1549", "propw1549", "propw")) |>
print() |>
dg_rates()
# The case of 4 factors (2 populations)
eg2.5 <- data.frame(
pop = c(1971, 1979),
birth_preg = c(25.3, 32.7),
preg_actw = c(.214, .290),
actw_prop = c(.279, .473),
w_prop = c(.949, .986)
)
dgnpop(eg2.5, pop="pop", c("birth_preg", "preg_actw", "actw_prop", "w_prop")) |>
print() |>
dg_rates()
# The case of 5 factors (2 populations)
eg2.7 <- data.frame(
pop = c(1970, 1980),
prop_m = c(.58, .72),
noncontr = c(.76, .97),
abort = c(.84, .97),
lact = c(.66, .56),
fecund = c(16.573, 16.158)
)
dgnpop(eg2.7, pop="pop", c("prop_m", "noncontr", "abort", "lact", "fecund")) |>
print() |>
dg_rates()
# The case of 3 vector factors (2 populations)
eg4.5 <- data.frame(
agegroup = rep(1:7, 2),
pop = rep(c(1970, 1960), e = 7),
bm = c(488, 452, 338, 156, 63, 22, 3,
393, 407, 369, 274, 184, 90, 16),
mw = c(.082, .527, .866, .941, .942, .923, .876,
.122, .622, .903, .930, .916, .873, .800),
wp = c(.056, .038, .032, .030, .026, .023, .019,
.043, .041, .036, .032, .026, .020, .018)
)
df = dgnpop(eg4.5, pop="pop", c("bm", "mw", "wp"), id_vars=c("agegroup")) |>
print() |>
dg_rates()
dgnpop(eg4.5, pop="pop", c("bm", "mw", "wp"), id_vars=c("agegroup")) |>
print() |>
dg_rates()
