) %>% select(year,prevalence,frequency,num_offenders,num_reconvicted,num_reconvictions) %>%
head %>% rbind(.,"...") %>% kable() %>%
column_spec(1:3,bold=T) %>%
column_spec(4:6, color = "grey1\0")
reconv %>% group_by(year) %>%
summarise_at(vars(starts_with("num")),sum) %>%
mutate(
prevalence=round(num_reconvicted/num_offenders,3),
frequency=round(num_reconvictions/num_reconvicted,3)
) %>% select(year,prevalence,frequency,num_offenders,num_reconvicted,num_reconvictions) %>%
head %>% rbind(.,"...") %>% kable() %>%
column_spec(1:3,bold=T) %>%
column_spec(4:6, color = "grey10")
?column_spec
reconv %>% group_by(year) %>%
summarise_at(vars(starts_with("num")),sum) %>%
mutate(
prevalence=round(num_reconvicted/num_offenders,3),
frequency=round(num_reconvictions/num_reconvicted,3)
) %>% select(year,prevalence,frequency,num_offenders,num_reconvicted,num_reconvictions) %>%
head %>% rbind(.,"...") %>% kable() %>%
column_spec(1:3,bold=T,background = "#D7261E") %>%
column_spec(4:6, color = "grey10")
reconv %>% group_by(year) %>%
summarise_at(vars(starts_with("num")),sum) %>%
mutate(
prevalence=round(num_reconvicted/num_offenders,3),
frequency=round(num_reconvictions/num_reconvicted,3)
) %>% select(year,prevalence,frequency,num_offenders,num_reconvicted,num_reconvictions) %>%
head %>% rbind(.,"...") %>% kable() %>%
column_spec(1:3,bold=T,color="white",background = "#D7261E") %>%
column_spec(4:6, color = "grey10")
reconv
reconv %>% mutate(
offenders=num_offenders,
reconvicted=num_reconvicted,
reconvictions=num_reconvictions
) %>% select(-starts_with("num"))
reconv %>% mutate(
offenders=num_offenders,
reconvicted=num_reconvicted,
reconvictions=num_reconvictions
) %>% select(-starts_with("num")) -> reconv
save(reconv,"data/reconv.RData")
save(reconv,fil="data/reconv.RData")
save(reconv,file="data/reconv.RData")
require(roxygen2)
require(devtools)
document()
build_vignettes()
data(reconv)
head(reconv)
knitr::opts_chunk$set(message=FALSE, warning=FALSE)
require(kableExtra)
library(tidyverse)
library(DasGuptR)
data(reconv)
str(reconv)
reconv %>% filter(year==2004) %>%
group_by(Gender, convicted_population) %>%
summarise_at(vars(starts_with("num")),sum) %>%
select(-reconvictions) %>%
bind_rows(.,
reconv %>% filter(year==2004) %>%
group_by(convicted_population) %>%
summarise_at(vars(starts_with("num")),sum) %>% mutate(Gender="All") %>%
select(-reconvictions)
) %>%
mutate(
prop_reconvicted = reconvicted/offenders,
prop_offenders = offenders/convicted_population,
crude_rate = prop_reconvicted*prop_offenders
) %>% select(Gender,offenders,reconvicted,convicted_population,prop_reconvicted, prop_offenders,crude_rate) %>%
kable(.,digits=2) %>%
row_spec(3, bold = T, color = "white", background = "#555555") %>%
column_spec(7,bold=T)
reconv %>% filter(year==2004) %>%
group_by(Gender, convicted_population) %>%
summarise_at(vars(starts_with("num")),sum) %>%
select(-reconvictions)
reconv %>% filter(year==2004) %>%
group_by(Gender, convicted_population) %>%
summarise_at(vars(starts_with("num")),sum) %>%
select(-reconvictions)
?one_of
reconv %>% filter(year==2004) %>%
group_by(Gender, convicted_population) %>%
summarise_at(vars(one_of(c("offenders","reconvicted","reconvictions"))),sum)
reconv %>% filter(year==2004) %>%
group_by(Gender, convicted_population) %>%
summarise_at(one_of(c("offenders","reconvicted","reconvictions")),sum)
build_vignettes()
?add_header_above
devtools::install_github("josiahpjking/DasGuptR")
build_vignettes()
reconv <-
reconv %>% mutate(
prevalence = reconvicted/offenders,
frequency = reconvictions/reconvicted,
pop_str = offenders/convicted_population
)
reconv_DG <- DasGupt_Npop(reconv,
pop=year,
prevalence, pop_str,
id_vars=c(Age,Gender),
ratefunction="prevalence*pop_str"
)
str(reconv_DG)
reconv <-
reconv %>% mutate(
prevalence = reconvicted/offenders,
frequency = reconvictions/reconvicted,
pop_str = offenders/convicted_population
) %>% filter(year %in% 2004:2006)
reconv_DG <- DasGupt_Npop(reconv,
pop=year,
prevalence, pop_str,
id_vars=c(Age,Gender),
ratefunction="prevalence*pop_str"
)
#the output is rather cumbersome.
#it includes a column for each population
str(reconv_DG)
build_vignettes()
build_vignettes()
.324/1.884
.324*1.884
#the output is rather cumbersome.
#it includes a column for each population
str(reconv_DG)
pop1=2004
pop2=2005
reconv_DG %>%
group_by(factor) %>%
summarise(
!!paste0("rate",pop1):=sum(get(paste0("pop",pop1))),
!!paste0("rate",pop2):=sum(get(paste0("pop",pop2)))
) %>% gather(year,rate,starts_with("rate")) %>%
mutate(year=as.numeric(gsub("rate","",year)))
#ADJUSTED RATES
reconv_DG %>%
group_by(factor) %>%
summarise(
!!paste0("rate",pop1):=sum(get(paste0("pop",pop1))),
!!paste0("rate",pop2):=sum(get(paste0("pop",pop2)))
) %>% gather(year,rate,starts_with("rate")) %>%
mutate(year=as.numeric(gsub("rate","",year))) -> std_rates
reconv_DG
std_rates
reconv %>% mutate(rate=prev*pop_str) %>%
filter(year %in% c(pop1,pop2)) %>%
group_by(year) %>% summarise(rate=sum(rate)) %>%
mutate(factor="crude") %>%
spread(year,rate) %>%
mutate(difference=get(paste0(pop1))-get(paste0(pop2)))
reconv %>% mutate(rate=prevalence*pop_str) %>%
filter(year %in% c(pop1,pop2)) %>%
group_by(year) %>% summarise(rate=sum(rate)) %>%
mutate(factor="crude") %>%
spread(year,rate) %>%
mutate(difference=get(paste0(pop1))-get(paste0(pop2)))
reconv %>% mutate(rate=prevalence*pop_str) %>%
filter(year %in% c(pop1,pop2)) %>%
group_by(year) %>% summarise(rate=sum(rate)) %>%
mutate(factor="crude") %>%
spread(year,rate) %>%
mutate(difference=get(paste0(pop1))-get(paste0(pop2))) %>%
#bind, and diff
bind_rows(std_rates %>%
spread(year,rate) %>%
mutate(difference=get(paste0(pop1))-get(paste0(pop2))),
.)
.000798+(-.00149)
#DG TABLE - CRUDE & DECOMP
reconv %>% mutate(rate=prevalence*pop_str) %>%
filter(year %in% c(pop1,pop2)) %>%
group_by(year) %>% summarise(rate=sum(rate)) %>%
mutate(factor="crude") %>%
spread(year,rate) %>%
mutate(difference=get(paste0(pop1))-get(paste0(pop2))) %>%
#bind, and diff
bind_rows(std_rates %>%
spread(year,rate) %>%
mutate(difference=get(paste0(pop1))-get(paste0(pop2))),
.) %>%
mutate(
percentage_of_crude=100*(difference/difference[factor=="crude"]),
#factor=fct_recode(factor(factor),"Offender mix"="age_str","Reconviction prevalence"="reconvs","Crude"="crude"),
#factor=fct_relevel(factor,"Crude")
) #-> dgtable
#DG TABLE - CRUDE & DECOMP
reconv %>% mutate(rate=prevalence*pop_str) %>%
filter(year %in% c(pop1,pop2)) %>%
group_by(year) %>% summarise(rate=sum(rate)) %>%
mutate(factor="crude") %>%
spread(year,rate) %>%
mutate(difference=get(paste0(pop1))-get(paste0(pop2))) %>%
#bind, and diff
bind_rows(std_rates %>%
spread(year,rate) %>%
mutate(difference=get(paste0(pop1))-get(paste0(pop2))),
.) %>%
mutate(
percentage_of_crude=100*(difference/difference[factor=="crude"]),
#factor=fct_recode(factor(factor),"Offender mix"="age_str","Reconviction prevalence"="reconvs","Crude"="crude"),
#factor=fct_relevel(factor,"Crude")
) #-> dgtable
#DG TABLE - CRUDE & DECOMP
reconv %>% mutate(rate=prevalence*pop_str) %>%
filter(year %in% c(pop1,pop2)) %>%
group_by(year) %>% summarise(rate=sum(rate)) %>%
mutate(factor="crude") %>%
spread(year,rate) %>%
mutate(difference=get(paste0(pop1))-get(paste0(pop2))) %>%
#bind, and diff
bind_rows(std_rates %>%
spread(year,rate) %>%
mutate(difference=get(paste0(pop1))-get(paste0(pop2))),
.) %>%
mutate(
percentage_of_crude=100*(difference/difference[factor=="crude"]),
#factor=fct_recode(factor(factor),"Offender mix"="age_str","Reconviction prevalence"="reconvs","Crude"="crude"),
#factor=fct_relevel(factor,"Crude")
) #-> dgtable
reconv <-
data(reconv) %>% mutate(
prevalence = reconvicted/offenders,
frequency = reconvictions/reconvicted,
pop_str = offenders/convicted_population
) %>% filter(year %in% 2004:2009)
data(reconv)
reconv <-
reconv %>% mutate(
prevalence = reconvicted/offenders,
frequency = reconvictions/reconvicted,
pop_str = offenders/convicted_population
) %>% filter(year %in% 2004:2009)
reconv_DG <- DasGupt_Npop(reconv,
pop=year,
prevalence, pop_str,
id_vars=c(Age,Gender),
ratefunction="prevalence*pop_str"
)
#the output is rather cumbersome.
#it includes a column for each population
str(reconv_DG)
pop1=2004
pop2=2005
#ADJUSTED RATES
reconv_DG %>%
group_by(factor) %>%
summarise(
!!paste0("rate",pop1):=sum(get(paste0("pop",pop1))),
!!paste0("rate",pop2):=sum(get(paste0("pop",pop2)))
) %>% gather(year,rate,starts_with("rate")) %>%
mutate(year=as.numeric(gsub("rate","",year))) -> std_rates
#DG TABLE - CRUDE & DECOMP
reconv %>% mutate(rate=prevalence*pop_str) %>%
filter(year %in% c(pop1,pop2)) %>%
group_by(year) %>% summarise(rate=sum(rate)) %>%
mutate(factor="crude") %>%
spread(year,rate) %>%
mutate(difference=get(paste0(pop1))-get(paste0(pop2))) %>%
#bind, and diff
bind_rows(std_rates %>%
spread(year,rate) %>%
mutate(difference=get(paste0(pop1))-get(paste0(pop2))),
.) %>%
mutate(
percentage_of_crude=100*(difference/difference[factor=="crude"]),
#factor=fct_recode(factor(factor),"Offender mix"="age_str","Reconviction prevalence"="reconvs","Crude"="crude"),
#factor=fct_relevel(factor,"Crude")
) #-> dgtable
pop1=2005
pop2=2006
#ADJUSTED RATES
reconv_DG %>%
group_by(factor) %>%
summarise(
!!paste0("rate",pop1):=sum(get(paste0("pop",pop1))),
!!paste0("rate",pop2):=sum(get(paste0("pop",pop2)))
) %>% gather(year,rate,starts_with("rate")) %>%
mutate(year=as.numeric(gsub("rate","",year))) -> std_rates
#DG TABLE - CRUDE & DECOMP
reconv %>% mutate(rate=prevalence*pop_str) %>%
filter(year %in% c(pop1,pop2)) %>%
group_by(year) %>% summarise(rate=sum(rate)) %>%
mutate(factor="crude") %>%
spread(year,rate) %>%
mutate(difference=get(paste0(pop1))-get(paste0(pop2))) %>%
#bind, and diff
bind_rows(std_rates %>%
spread(year,rate) %>%
mutate(difference=get(paste0(pop1))-get(paste0(pop2))),
.) %>%
mutate(
percentage_of_crude=100*(difference/difference[factor=="crude"]),
#factor=fct_recode(factor(factor),"Offender mix"="age_str","Reconviction prevalence"="reconvs","Crude"="crude"),
#factor=fct_relevel(factor,"Crude")
) #-> dgtable
#DG TABLE - CRUDE & DECOMP
reconv %>% mutate(rate=prevalence*pop_str) %>%
filter(year %in% c(pop1,pop2)) %>%
group_by(year) %>% summarise(rate=sum(rate)) %>%
mutate(factor="crude") %>%
spread(year,rate) %>%
mutate(difference=get(paste0(pop1))-get(paste0(pop2))) %>%
#bind, and diff
bind_rows(std_rates %>%
spread(year,rate) %>%
mutate(difference=get(paste0(pop1))-get(paste0(pop2))),
.) %>%
mutate(
percentage_of_crude=100*(difference/difference[factor=="crude"]),
#factor=fct_recode(factor(factor),"Offender mix"="age_str","Reconviction prevalence"="reconvs","Crude"="crude"),
#factor=fct_relevel(factor,"Crude")
) #-> dgtable
reconv %>%
mutate(rate = prevalence*pop_str) %>%
group_by(year) %>%
summarise(
rate=sum(rate),
factor="crude"
) %>%
bind_rows(.,
reconv_DG %>%
group_by(factor) %>%
summarise_at(vars(starts_with("pop")),sum) %>%
gather(year,rate,starts_with("pop")) %>%
mutate(year=as.numeric(gsub("pop","",year)))
) %>%
mutate(
rate=rate*100
) %>%
ggplot(.,aes(x=year,y=rate,col=factor))
reconv %>%
mutate(rate = prevalence*pop_str) %>%
group_by(year) %>%
summarise(
rate=sum(rate),
factor="crude"
) %>%
bind_rows(.,
reconv_DG %>%
group_by(factor) %>%
summarise_at(vars(starts_with("pop")),sum) %>%
gather(year,rate,starts_with("pop")) %>%
mutate(year=as.numeric(gsub("pop","",year)))
) %>%
mutate(
rate=rate*100
) %>%
ggplot(.,aes(x=year,y=rate,col=factor))+
geom_path()
pop1=2006
pop2=2007
#ADJUSTED RATES
reconv_DG %>%
group_by(factor) %>%
summarise(
!!paste0("rate",pop1):=sum(get(paste0("pop",pop1))),
!!paste0("rate",pop2):=sum(get(paste0("pop",pop2)))
) %>% gather(year,rate,starts_with("rate")) %>%
mutate(year=as.numeric(gsub("rate","",year))) -> std_rates
#DG TABLE - CRUDE & DECOMP
reconv %>% mutate(rate=prevalence*pop_str) %>%
filter(year %in% c(pop1,pop2)) %>%
group_by(year) %>% summarise(rate=sum(rate)) %>%
mutate(factor="crude") %>%
spread(year,rate) %>%
mutate(difference=get(paste0(pop1))-get(paste0(pop2))) %>%
#bind, and diff
bind_rows(std_rates %>%
spread(year,rate) %>%
mutate(difference=get(paste0(pop1))-get(paste0(pop2))),
.) %>%
mutate(
percentage_of_crude=100*(difference/difference[factor=="crude"]),
#factor=fct_recode(factor(factor),"Offender mix"="age_str","Reconviction prevalence"="reconvs","Crude"="crude"),
#factor=fct_relevel(factor,"Crude")
) #-> dgtable
data(reconv)
reconv <-
reconv %>% mutate(
prevalence = reconvicted/offenders,
frequency = reconvictions/reconvicted,
pop_str = offenders/convicted_population
)
reconv_DG <- DasGupt_Npop(reconv,
pop=year,
prevalence, pop_str,
id_vars=c(Age,Gender),
ratefunction="prevalence*pop_str"
)
reconv %>%
mutate(rate = prevalence*pop_str) %>%
group_by(year) %>%
summarise(
rate=sum(rate),
factor="crude"
) %>%
bind_rows(.,
reconv_DG %>%
group_by(factor) %>%
summarise_at(vars(starts_with("pop")),sum) %>%
gather(year,rate,starts_with("pop")) %>%
mutate(year=as.numeric(gsub("pop","",year)))
) %>%
mutate(
rate=rate*100
) %>%
ggplot(.,aes(x=year,y=rate,col=factor))+
geom_path()+
scale_color_manual(values = c("black","#1b9e77","#d95f02"))+
theme_bw()+
labs(y = "Reconviction Rate",
colour = "Rate",
x = "Year")+
theme(legend.position="bottom",axis.text.x = element_text(angle = 45, hjust = 1)) +
guides(colour = guide_legend(nrow = 3, byrow = TRUE)) +
scale_x_continuous(breaks=2004:2016,labels=2004:2016)+
geom_label(aes(x=2011.5,y=31,label="If reconviction rates for each group stayed\nthe same, the changing 'offender mix'\nwould mean the overall rate would still decrease"),col="#555555",size=3,label.size=NA,hjust=0,vjust=.5)+
geom_curve(aes(x=2011.5,y=31,xend=2012,yend=29.7),col="#555555",curvature=.2,arrow=arrow(length=unit(.03,"npc")))+
NULL
reconv %>%
mutate(rate = prevalence*pop_str) %>%
group_by(year) %>%
summarise(
rate=sum(rate),
factor="crude"
) %>%
bind_rows(.,
reconv_DG %>%
group_by(factor) %>%
summarise_at(vars(starts_with("pop")),sum) %>%
gather(year,rate,starts_with("pop")) %>%
mutate(year=as.numeric(gsub("pop","",year)))
) %>%
mutate(
rate=rate*100
) %>%
ggplot(.,aes(x=year,y=rate,col=factor))+
geom_path()+
scale_color_manual(values = c("black","#1b9e77","#d95f02"))+
NULL
reconv %>%
mutate(rate = prevalence*pop_str) %>%
group_by(year) %>%
summarise(
rate=sum(rate),
factor="crude"
) %>%
bind_rows(.,
reconv_DG %>%
group_by(factor) %>%
summarise_at(vars(starts_with("pop")),sum) %>%
gather(year,rate,starts_with("pop")) %>%
mutate(year=as.numeric(gsub("pop","",year)))
) %>%
mutate(
rate=rate*100
) %>%
ggplot(.,aes(x=year,y=rate,col=factor))+
geom_path()+
scale_color_manual(values = c("black","#1b9e77","#d95f02"))+
ylim(0,100)+
NULL
reconv %>%
mutate(rate = prevalence*pop_str) %>%
group_by(year) %>%
summarise(
rate=sum(rate),
factor="crude"
) %>%
bind_rows(.,
reconv_DG %>%
group_by(factor) %>%
summarise_at(vars(starts_with("pop")),sum) %>%
gather(year,rate,starts_with("pop")) %>%
mutate(year=as.numeric(gsub("pop","",year)))
) %>%
mutate(
rate=rate*100
) %>%
ggplot(.,aes(x=year,y=rate,col=factor))+
geom_path()+
scale_color_manual(values = c("black","#1b9e77","#d95f02"))+
ylim(0,50)+
NULL
reconv %>%
mutate(rate = prevalence*pop_str) %>%
group_by(year) %>%
summarise(
rate=sum(rate),
factor="crude"
) %>%
bind_rows(.,
reconv_DG %>%
group_by(factor) %>%
summarise_at(vars(starts_with("pop")),sum) %>%
gather(year,rate,starts_with("pop")) %>%
mutate(year=as.numeric(gsub("pop","",year)))
) %>%
mutate(
rate=rate*100
) %>%
ggplot(.,aes(x=year,y=rate,col=factor))+
geom_path()+
scale_color_manual(values = c("black","#1b9e77","#d95f02"))+
ylim(20,40)+
NULL
str(reconv_DG)
